<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>IndexedDB</title>
  </head>
  <body>
    <h1>IndexedDB</h1>
    <script>
      // 사용자 목록
      const userList = [
        { id: 'user01', age: 5, name: 'John' },
        { id: 'user02', age: 16, name: 'Amy' },
        { id: 'user03', age: 11, name: 'Tom' },
        { id: 'user04', age: 20, name: 'Jessica' },
        { id: 'user05', age: 18, name: 'Ellis' }
      ];

      // 코드 작성
      let db = null;
      const DB_VERSION = 3;
      const request = window.indexedDB.open('user-db', DB_VERSION);

      request.onerror = function (event) {
        console.error(event);
      };

      request.onsuccess = function (event) {
        db = request.result;
      };

      request.onupgradeneeded = function (event) {
        console.log('OLD', event.oldVersion);
        console.log('NEW', DB_VERSION);

        if (event.oldVersion < 2) {
          const db = request.result;
          const userStore = db.createObjectStore('user', { keyPath: 'id' });

          userList.forEach((user) => {
            userStore.add(user);
          });
        }

        if (event.oldVersion < 3) {
          const userStore = request.transaction.objectStore('user');
          userStore.createIndex('user_name', 'name', { unique: true });
          userStore.createIndex('user_age', 'age');
        }
      };
    </script>
  </body>
</html>
